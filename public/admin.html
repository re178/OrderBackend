<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; }
  h1 { text-align:center; color: #333; }
  table { width:100%; border-collapse: collapse; margin-top:20px; background:white; }
  th, td { border:1px solid #ccc; padding:8px; text-align:left; }
  th { background:#007BFF; color:white; }
  button { padding:5px 10px; margin:2px; cursor:pointer; }
  a.download { text-decoration:none; color:#007BFF; }
  textarea, input { width: 100%; margin:5px 0; padding:5px; }
</style>
</head>
<body>
<h1>Admin Dashboard</h1>

<div style="text-align:center;">
  <button onclick="downloadPDF()">Download All Orders PDF</button>
</div>

<h2>Orders List</h2>
<table id="ordersTable">
  <thead>
    <tr>
      <th>#</th>
      <th>Name</th>
      <th>Email</th>
      <th>Category</th>
      <th>Requirements</th>
      <th>File</th>
      <th>Date</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h2>Send Email to Client</h2>
<input type="email" id="singleEmail" placeholder="Client email">
<input type="text" id="emailSubject" placeholder="Subject">
<textarea id="emailMessage" placeholder="Message"></textarea>
<button onclick="sendEmail()">Send Email</button>

<h2>Send Email to All Clients</h2>
<input type="text" id="allSubject" placeholder="Subject">
<textarea id="allMessage" placeholder="Message"></textarea>
<button onclick="sendEmailAll()">Send to All</button>

<script>
async function fetchOrders(){
  const res = await fetch('/admin/orders-data');
  const orders = await res.json();
  const tbody = document.querySelector('#ordersTable tbody');
  tbody.innerHTML = '';
  orders.forEach(order => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${order.index+1}</td>
      <td>${order.fullname}</td>
      <td>${order.email}</td>
      <td>${order.category}</td>
      <td>${order.requirements}</td>
      <td>${order.file ? '<a href="/uploads/'+order.file+'" target="_blank" class="download">Download</a>':'No file'}</td>
      <td>${order.date}</td>
      <td>
        <button onclick="deleteOrder(${order.index})">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

async function deleteOrder(index){
  if(!confirm('Are you sure you want to delete this order?')) return;
  await fetch(`/admin/order/${index}`, { method:'DELETE' });
  fetchOrders();
}

function downloadPDF(){
  window.location.href = '/admin/orders/pdf';
}

async function sendEmail(){
  const email = document.getElementById('singleEmail').value;
  const subject = document.getElementById('emailSubject').value;
  const message = document.getElementById('emailMessage').value;
  const res = await fetch('/admin/email-client',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({email, subject, message})
  });
  alert(await res.text());
}

async function sendEmailAll(){
  const subject = document.getElementById('allSubject').value;
  const message = document.getElementById('allMessage').value;
  const res = await fetch('/admin/email-all',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({subject, message})
  });
  alert(await res.text());
}

// Load orders initially
fetchOrders();
</script>
</body>
</html>
